<?phpnamespace Share\Controller;use Common\Api\Api;use Share\Model\ShareModel;class ApiController extends Api {    protected $db;    protected $id;    function _initialize() {        parent::_initialize();        $this->db = new ShareModel();        $this->id = trim(I('id', 0));    }    /**     * 类别列表     */    function categoryLists() {        $db = new \Share\Model\CategoryModel();        $type = I('type','');        $data = $db->lists($type);        $this->jsonOutput($data);    }        /**     * 检查群是否存在     */    function isGroups(){        $db = new \Share\Model\GroupModel();        if (!$db->where(array('id'=>$this->id))->count()){            $data = showData(new \stdClass(), '该群不存在', 1);            return showData($data);        }    }    /**     * 创建群     */    function addGroups() {        self::isLogin();        $db = new \Share\Model\GroupModel();        $data = $db->addGroups($this->mid);        $this->jsonOutput($data);    }    /**     * 群列表     */    function groupsList(){        self::isLogin();        $db = new \Share\Model\GroupModel();        $data = $db->lists($this->mid);        $this->jsonOutput($data);    }    /**     * 群详细     */    function groupsDetail() {        self::isLogin();        self::isGroups();        $db = new \Share\Model\GroupModel();        $data = $db->detail($this->mid, $this->id);        $this->jsonOutput($data);    }    /**     * 设置默认号     */    function setDefaultGroups(){        self::isLogin();        self::isGroups();        $db = new \Share\Model\GroupModel();        $data = $db->setDefault($this->mid, $this->id);        $this->jsonOutput($data);    }    /**     * 添加关注与取消关注     */    function follow(){        self::isLogin();        self::isGroups();        $db = new \Share\Model\GroupModel();        $data = $db->follow($this->mid, $this->id);        $this->jsonOutput($data);    }    /**     * 分享     */    function isShare(){        if (!$this->db->where(array('id'=>$this->id))->count()){            $data = showData(new \stdClass(), '该分享不存在或已被删除', 1);            $this->jsonOutput($data);        }    }    /**     * 发布分享     */    function addShare() {        self::isLogin();        $data = $this->db->addShare($this->mid);        $this->jsonOutput($data);    }    /**     * 转发分享     */    function forwardShare(){        self::isLogin();        self::isShare();        $data = $this->db->addShare($this->mid, $this->id, 1);        $this->jsonOutput($data);    }    /**     * 列表数据     */    function shareLists(){        self::isLogin();        if ($this->id) self::isGroups();        $data = $this->db->lists($this->mid, $this->id);        $this->jsonOutput($data);    }    /**     * 详情     */    function shareDetail(){        self::isLogin();        $data = array('id'=>$this->id);        $data = $this->db->shareDetail($this->mid,$data);        $this->jsonOutput($data);    }    function categorysharelists(){    	self::isLogin();    	$data = $this->db->categorysharelists($this->mid, $this->id);    	$this->jsonOutput($data);    }    function delShare(){    	self::isLogin();    	$id = I("id", 0);    	$data = $this->db->delShare($this->mid, $id);    	$this->jsonOutput($data);    }    /**     * 详细     */    function detail() {        self::isLogin();        self::isShare();        $data = $this->db->detail($this->mid, $this->id);        $this->jsonOutput($data);    }    /**     * 添加赞和取消赞     */    function praise() {        self::isLogin();        self::isShare();        $data = $this->db->praise($this->mid, $this->id);        $this->jsonOutput($data);    }    /**     * 发布回复     */    function addReply(){        self::isLogin();        self::isShare();        $fuid = $this->_initUser(I('fuid'));        $db = new \Share\Model\ReplyModel();        $data = $db->addReply($this->mid, $fuid, $this->id);        $this->jsonOutput($data);    }    /**     * 回复列表     */    function replyList() {        self::isLogin();        self::isShare();        $db = new \Share\Model\ReplyModel();        $data = $db->replyList($this->mid, $this->id);        $this->jsonOutput($data);    }    /**     * 加入黑名单和取消黑名单     */    function addBlack() {        self::isLogin();        self::isGroups();        $db = new \Share\Model\GroupModel();        $data = $db->addBlack($this->mid, $this->id);        $this->jsonOutput($data);    }    /**     * 编辑资料 编辑个人资料、设置默认头像、删除图片、更换主图、新增图片     * @param number $uid     */    function edit() {        self::isLogin();        self::isGroups();        $db = new \Share\Model\GroupModel();        $data = $db->edit($this->mid, $this->id);        $this->jsonOutput($data);    }    /**     * 新增图片     */    function addHead($uid){        self::isLogin();        self::isGroups();        $db = new \Share\Model\GroupModel();        $data = $db->addHead($this->mid, $this->id);        $this->jsonOutput($data);    }    /**     * 删除图片     */    function deleteHead($uid){        self::isLogin();        self::isGroups();        $db = new \Share\Model\GroupModel();        $data = $db->deleteHead($this->mid);        $this->jsonOutput($data);    }    /**     * 设置默认图片     */    function setDefaultHead($uid){        self::isLogin();        self::isGroups();        $db = new \Share\Model\GroupModel();        $data = $db->setDefaultHead($this->mid, $this->id);        $this->jsonOutput($data);    }    /**     * 更换主图     */    function editBackground($uid){        self::isLogin();        self::isGroups();        $db = new \Share\Model\GroupModel();        $data = $db->editBackground($this->mid, $this->id);        $this->jsonOutput($data);    }}