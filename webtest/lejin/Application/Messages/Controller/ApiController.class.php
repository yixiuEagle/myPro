<?php/** * 留言管理 */namespace Messages\Controller;use Common\Api\Api;use Messages\Model\MessagesModel;class ApiController extends Api {    protected $id;    protected $db;    function _initialize() {        parent::_initialize();        $this->id = trim(I('id', 0));        $this->db = new MessagesModel();    }    /**     * 检查留言     */    function isMessages() {        if (!$this->db->where(array('id'=>$this->id))->count()){	        $data = showData(new \stdClass(), '该留言不存在', 1);	        $this->jsonOutput($data);	    }    }    /**     * 发布留言     */    function addMessages() {        self::isLogin();        $data = $this->db->addMessages($this->mid);        $this->jsonOutput($data);    }    function delMessages() {        \Think\Log::write('<<<<<'.json_encode($_REQUEST).' delMessages-START>>>>>','WARN',C('LOG_TYPE'),C('LOG_PATH').date('y_m_d').'-----.log');    	self::isLogin();    	$id = I("id", 0);    	$data = $this->db->delMessages($this->mid, $id);    	$this->jsonOutput($data);    }        /**     * 转发分享     */    function forwardMessages(){        self::isLogin();        self::isMessages();        $data = $this->db->addMessages($this->mid, $this->id, 1);        $this->jsonOutput($data);    }    /**     * 留言列表     */    function messagesList(){        self::isLogin();        $data = $this->db->lists($this->mid);        $this->jsonOutput($data);    }    /**     * 留言详细     */    function detail(){        self::isLogin();        self::isMessages();        $data = $this->db->detail($this->mid, $this->id);        $this->jsonOutput($data);    }    /**     * 我的留言     */    function myMessagesList(){        self::isLogin();        $data = $this->db->myLists($this->mid);        $this->jsonOutput($data);    }    function hisLists(){    	self::isLogin();    	$fuid = I('fuid');    	$data = $this->db->hisLists($this->mid, $fuid);    	$this->jsonOutput($data);    }    /**     * 消息的赞和取消赞     */    function praise(){        self::isLogin();        self::isMessages();        $data = $this->db->praise($this->mid, $this->id);        $this->jsonOutput($data);    }    /**     * 发布回复     */    function addReply(){        self::isLogin();        self::isMessages();        $fuid = $this->_initUser(I('fuid'));        $parentid = I('parentid',0);        $db = new \Messages\Model\ReplyModel();        $data = $db->addReply($this->mid, $fuid, $this->id, $parentid);        $this->jsonOutput($data);    }    /**     * 回复列表     */    function replyList() {        self::isLogin();        self::isMessages();        $db = new \Messages\Model\ReplyModel();        $data = $db->replyList($this->mid, $this->id);        $this->jsonOutput($data);    }    /**     * 广告列表     */    function bannerList() {        $db = new \Messages\Model\BannerModel();        $data = $db->lists();        $this->jsonOutput($data);    }}